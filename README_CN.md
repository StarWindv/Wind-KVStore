# Wind-KVStore

[English](./README.md)

![GitHub License](https://img.shields.io/badge/license-MIT-blue.svg)
![Rust Version](https://img.shields.io/badge/rust-1.65%2B-orange)

Wind-KVStore æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é«˜æ•ˆä¸”æŒä¹…çš„é”®å€¼å­˜å‚¨å¼•æ“ï¼Œé‡‡ç”¨ Rust å®ç°ã€‚é¡¹ç›®ç»“åˆäº†é«˜æ€§èƒ½å­˜å‚¨å¼•æ“ä¸ç”¨æˆ·å‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œé€‚ç”¨äºéœ€è¦æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨çš„åœºæ™¯ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **ğŸ“ æŒä¹…åŒ–å­˜å‚¨** - æ•°æ®å®‰å…¨å†™å…¥ç£ç›˜ï¼Œæ”¯æŒå´©æºƒæ¢å¤
- **ğŸ“ é¢„å†™æ—¥å¿—(WAL)** - ç¡®ä¿æ“ä½œåŸå­æ€§å’ŒæŒä¹…æ€§
- **âš¡ å†…å­˜æ˜ å°„æ–‡ä»¶** - æä¾›é«˜æ•ˆçš„æ–‡ä»¶è®¿é—®æ€§èƒ½
- **ğŸ—‚ï¸ LRU ç¼“å­˜** - è‡ªåŠ¨ç®¡ç†çƒ­ç‚¹æ•°æ®ç¼“å­˜
- **ğŸ”¢ åˆ†é¡µå­˜å‚¨** - æ”¯æŒæº¢å‡ºé¡µå¤„ç†å¤§å€¼æ•°æ®
- **â™»ï¸ ç©ºé—²é¡µç®¡ç†** - é«˜æ•ˆå¤ç”¨ç£ç›˜ç©ºé—´
- **ğŸ—œï¸ æ•°æ®åº“å‹ç¼©** - ä¼˜åŒ–å­˜å‚¨ç©ºé—´åˆ©ç”¨ç‡
- **ğŸ’» äº¤äº’å¼ Shell** - æä¾›ç›´è§‚çš„å‘½ä»¤è¡Œæ“ä½œç•Œé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Rustå·¥å…·é“¾([å®‰è£…æŒ‡å—](https://www.rust-lang.org/tools/install))

### å®‰è£…ä¸è¿è¡Œ

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/starwindv/wind-kvstore
cd wind-kvstore

# æ„å»ºé¡¹ç›®
cargo build --release

# è¿è¡Œäº¤äº’å¼ Shell
cargo run
```

## ğŸ’» äº¤äº’å¼ Shell ä½¿ç”¨æŒ‡å—

### å¯åŠ¨ç•Œé¢
```
Welcome to Wind-KVStore!

â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
 â•šâ•â•â•â•šâ•â•â•     â•šâ•â•    â•šâ•â•  â•šâ•â•â•â•    â•šâ•â•â•â•â•â• 

v0.0.1 [compiled 2023-10-15 14:30:00]
Type ".help;" for usage hints.

KVStore > 
```

### Shellæ“ä½œç¤ºä¾‹

```
.open my_database.db;

PUT "username":"john_doe", "email":"john@example.com";

GET WHERE KEY="username";

DEL WHERE KEY="email";

COMPACT;

IDENTIFIER SET "UserDatabase";

IDENTIFIER GET;

.close;

.quit;
```
æ³¨æ„ï¼šå½“å‰ä¸æ”¯æŒ`--`ç­‰æ³¨é‡Šæ ¼å¼
### ğŸ“š Shell å‘½ä»¤å‚è€ƒ

| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `.open <path>` | æ‰“å¼€/åˆ›å»ºæ•°æ®åº“ | `.open data.db;` |
| `.close` | å…³é—­å½“å‰æ•°æ®åº“ | `.close;` |
| `.help` | æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ | `.help;` |
| `.clear` | æ¸…å± | `.clear;` |
| `.title` | æ˜¾ç¤ºæ ‡é¢˜ä¿¡æ¯ | `.title;` |
| `.quit` | é€€å‡ºç¨‹åº | `.quit;` |
| `PUT "key":"value"` | æ’å…¥é”®å€¼å¯¹ | `PUT "name":"Alice";` |
| `GET WHERE KEY="key"` | æŸ¥è¯¢é”®å€¼ | `GET WHERE KEY="age";` |
| `DEL WHERE KEY="key"` | åˆ é™¤é”®å€¼ | `DEL WHERE KEY="temp";` |
| `COMPACT` | å‹ç¼©æ•°æ®åº“ | `COMPACT;` |
| `IDENTIFIER SET "id"` | è®¾ç½®æ•°æ®åº“æ ‡è¯†ç¬¦ | `IDENTIFIER SET "AppDB";` |
| `IDENTIFIER GET` | è·å–æ•°æ®åº“æ ‡è¯†ç¬¦ | `IDENTIFIER GET;` |

## ğŸ“¦ ä½œä¸ºåº“ä½¿ç”¨

### æ·»åŠ ä¾èµ–

åœ¨ `Cargo.toml` ä¸­æ·»åŠ ï¼š

```toml
[dependencies]
wind-kvstore = { git = "https://github.com/starwindv/wind-kvstore" }
```

### libç”¨æ³•ç¤ºä¾‹

```rust
use wind_kvstore::KVStore;
use anyhow::Result;

fn main() -> Result<()> {
    // æ‰“å¼€æ•°æ®åº“
    let mut store = KVStore::open("app_data.db", Some("MyAppDB"))?;
    
    // å­˜å‚¨æ•°æ®
    store.put(b"username", b"alice")?;
    
    // æ£€ç´¢æ•°æ®
    if let Some(value) = store.get(b"username")? {
        println!("Username: {}", String::from_utf8_lossy(&value));
    }
    
    // åˆ é™¤æ•°æ®
    store.delete(b"username")?;
    
    // è®¾ç½®æ•°æ®åº“æ ‡è¯†ç¬¦
    store.set_identifier("UserDatabase")?;
    
    // å‹ç¼©æ•°æ®åº“
    store.compact()?;
    
    // å…³é—­æ•°æ®åº“
    store.close()?;
    
    Ok(())
}
```

### æ ¸å¿ƒ API

```rust
impl KVStore {
    /// æ‰“å¼€æˆ–åˆ›å»ºæ•°æ®åº“
    pub fn open<P: AsRef<Path>>(
        path: P, 
        db_identifier: Option<&str>
    ) -> Result<Self>;
    
    /// å­˜å‚¨é”®å€¼å¯¹
    pub fn put(&mut self, key: &[u8], value: &[u8]) -> Result<()>;
    
    /// æ£€ç´¢é”®å€¼
    pub fn get(&mut self, key: &[u8]) -> Result<Option<Vec<u8>>>;
    
    /// åˆ é™¤é”®å€¼
    pub fn delete(&mut self, key: &[u8]) -> Result<()>;
    
    /// å‹ç¼©æ•°æ®åº“
    pub fn compact(&mut self) -> Result<()>;
    
    /// è·å–æ•°æ®åº“æ ‡è¯†ç¬¦
    pub fn get_identifier(&self) -> &str;
    
    /// è®¾ç½®æ•°æ®åº“æ ‡è¯†ç¬¦
    pub fn set_identifier(&mut self, identifier: &str) -> Result<()>;
    
    /// å…³é—­æ•°æ®åº“
    pub fn close(mut self) -> Result<()>;
}
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ build.rs            # æ„å»ºè„šæœ¬ï¼ˆè®°å½•ç¼–è¯‘æ—¶é—´ï¼‰
â”œâ”€â”€ Cargo.toml          # é¡¹ç›®é…ç½®å’Œä¾èµ–ç®¡ç†
â”œâ”€â”€ README.md           # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ README_CN.md           # é¡¹ç›®ä¸­æ–‡æ–‡æ¡£
â””â”€â”€ src
    â”œâ”€â”€ kvstore.rs      # é”®å€¼å­˜å‚¨å¼•æ“æ ¸å¿ƒå®ç°
    â”œâ”€â”€ main.rs         # ç¨‹åºå…¥å£ç‚¹
    â””â”€â”€ shell.rs        # äº¤äº’å¼å‘½ä»¤è¡Œ Shell å®ç°
```

## âš™ï¸ æŠ€æœ¯å®ç°

### å­˜å‚¨æ¶æ„
```
+-----------------------+
|      æ–‡ä»¶å¤´ (128B)     |
+-----------------------+
|      é¡µå¤´ (16B)        |
+-----------------------+
|       é”®å€¼æ•°æ®          |
+-----------------------+
|      æº¢å‡ºé¡µæŒ‡é’ˆ         |
+-----------------------+
|         ...           |
+-----------------------+
```

### å…³é”®ç‰¹æ€§

1. **åˆ†é¡µå­˜å‚¨**  
   - å›ºå®šå¤§å°é¡µé¢ï¼ˆé»˜è®¤ 1KBï¼‰
   - æ”¯æŒæº¢å‡ºé¡µå¤„ç†å¤§å€¼æ•°æ®
   - ç©ºé—²é¡µé“¾è¡¨ç®¡ç†

2. **é¢„å†™æ—¥å¿—**  
   - æ“ä½œæ—¥å¿—è®°å½•
   - å´©æºƒåè‡ªåŠ¨æ¢å¤
   - åŸå­æ€§æ“ä½œä¿è¯

3. **ç¼“å­˜ç®¡ç†**  
   - LRU ç¼“å­˜ç­–ç•¥
   - è‡ªåŠ¨çƒ­ç‚¹æ•°æ®ç®¡ç†
   - 100KB é»˜è®¤ç¼“å­˜å¤§å°

4. **ç©ºé—´ä¼˜åŒ–**  
   - è‡ªåŠ¨ç©ºé—²é¡µå›æ”¶
   - åœ¨çº¿æ•°æ®åº“å‹ç¼©
   - é«˜æ•ˆå­˜å‚¨å¸ƒå±€

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼
æˆ‘ä»¬å»ºè®®æ‚¨åœ¨åšå‡ºè´¡çŒ®æ—¶ï¼š
 - æ›´æ–°ç›¸å…³æ–‡æ¡£
 - æäº¤æ¸…æ™°çš„ PR æè¿°

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](https://github.com/StarWindv/Wind-KVStore/LICENSE)
